<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="CSS/dash_subadmin_verify.css">
    <title>dash_subadmin_verify</title>
</head>

<body>
    <div class="subadminverifydashboard">
        <h1 id="header">Welcome <span id="welcome"></span></h1>
        <button id="logout" onclick="logoutbtnhandler()">logout</button>
        <table>
            <thead>
                <tr>
                    <th>id</th>
                    <th>name</th>
                    <th>dob</th>
                    <th>age</th>
                    <th>mob</th>
                    <th>present address</th>
                    <th>permanent address</th>
                    <th>email</th>
                    <th>role</th>
                    <th>status</th>
                    <th>Verify</th>

                </tr>
            </thead>
            <tbody id="tabledata"></tbody>

        </table>
    </div>
</body>

<script>
    var xhr = new XMLHttpRequest();
    xhr.open("GET", "http://localhost:8080/employees", true);
    xhr.getResponseHeader("Content-Type", "application/json");
    xhr.onload = function () {
        var employees = JSON.parse(xhr.responseText);
        console.log(employees)
        tabledata(employees);
    }
    xhr.send();

    //TABLE DATA HANDLER
    function tabledata(employees) {
        let html = "";
        for (let employee of employees) {
            //if (employee.role == 4 || employee.role == 2 ) {
                html += "<tr><td>" + employee.id + "</td><td>" + employee.name + "</td><td>" + employee.dob + "</td><td>" + employee.age + "</td><td>" + employee.mob + "</td><td>" + employee.presentAddress + "</td><td>" + employee.permanentAddress + "</td><td>" + employee.email + "</td><td>" + employee.role + "</td><td>" + (employee.status === 1 ? "Verified" : "Pending") + "</td><td>"+(employee.role === 4 ||employee.role===2 ? "<input id='" + employee.id + "' type='checkbox' onclick=tick(" + employee.id + ") " + (employee.status === 1 ? "checked" : "") + " >" + (employee.status == 0 ? ((employee.created_by == employee.id) && (employee.updated_by === "null") ? "Created" : "Updated") : "") + "" : "")+"</td></tr>"
            
        }
        //console.log(html);
        var tab = document.getElementById("tabledata");
        tab.innerHTML = html;
        var id = localStorage.getItem("login_id");
        var data = { id: id }
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "http://localhost:8080/employee/getIdDetails", true)
        xhr.setRequestHeader("Content-type", "application/json;charset=UTF-8")
        xhr.onload = function () {
            var emp = JSON.parse(xhr.responseText);
            document.getElementById("welcome").innerHTML = emp.name
        }
        xhr.send(JSON.stringify(data));
    }

    //CHECKBOX HANDLER
    function tick(id) {
        var box = document.getElementById(id).checked;
        console.log(box);
        if (box === false) {
            console.log(box)
            var data = { id: id };
            console.log(data);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "http://localhost:8080/employee/getIdDetails", true);
            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            xhr.onload = function () {
                var employee = JSON.parse(xhr.responseText);
                console.log(employee);
                employee.status = 0;
                employee.updated_by = localStorage.getItem("login_id");
                console.log(employee.status);
                var xrh = new XMLHttpRequest();
                xrh.open("POST", "http://localhost:8080/employee/update", true);
                xrh.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                xrh.onload = function () {
                    console.log(xrh.responseText);
                }
                xrh.send(JSON.stringify(employee));
            }
            xhr.send(JSON.stringify(data));
        }
        else {
            var data = { id: id };
            console.log(data);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "http://localhost:8080/employee/getIdDetails", true)
            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            xhr.onload = function () {
                var employee = JSON.parse(xhr.responseText);
                console.log(employee);
                employee.status = 1;
                employee.updated_by = localStorage.getItem("login_id");
                console.log(employee.status);
                var xrh = new XMLHttpRequest();
                xrh.open("POST", "http://localhost:8080/employee/update", true)
                xrh.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                xrh.onload = function () {
                    console.log(xrh.responseText);
                }
                xrh.send(JSON.stringify(employee));
            }
            xhr.send(JSON.stringify(data));
        }
    }

    //LOGOUT BUTTON HANDLER
    function logoutbtnhandler() {
        window.location.href = "login.html";
    }
</script>

</html>